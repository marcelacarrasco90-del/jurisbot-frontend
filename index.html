<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JurisBot Laboral Chile</title>

<!-- â•â• GA4: reemplaza G-XXXXXXXXXX con tu Measurement ID real â•â•
     ObtÃ©n tu ID en: analytics.google.com â†’ Admin â†’ Data Streams -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>

<!-- â•â• PWA â•â• -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#1a3a5c">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="JurisBot">

<style>
/* â•â• RESET & VARIABLES â•â• */
*{margin:0;padding:0;box-sizing:border-box}
:root{--p:#1a3a5c;--a:#c0392b;--g:#27ae60;--bg:#f4f6f9;--card:#fff;--t:#2c3e50;--m:#7f8c8d;--b:#dce3ec;--purple:#8e44ad}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--t);height:100vh;display:flex;flex-direction:column;overflow:hidden}

/* â•â• DISCLAIMER MODAL â•â• */
#disclaimerOverlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:9999;padding:16px}
#disclaimerBox{background:#fff;border-radius:14px;max-width:520px;width:100%;box-shadow:0 8px 40px rgba(0,0,0,.25);overflow:hidden}
.disc-header{background:var(--p);color:#fff;padding:18px 22px;display:flex;align-items:center;gap:12px}
.disc-icon{font-size:28px}
.disc-header h2{font-size:14px;font-weight:700;line-height:1.3}
.disc-header p{font-size:10px;opacity:.75;margin-top:2px}
.disc-body{padding:20px 22px;max-height:55vh;overflow-y:auto;font-size:12px;line-height:1.75;color:var(--t)}
.disc-body::-webkit-scrollbar{width:4px}.disc-body::-webkit-scrollbar-thumb{background:#ccc;border-radius:2px}
.disc-section{margin-bottom:14px}
.disc-section h3{font-size:11px;font-weight:700;color:var(--a);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.disc-numeral{background:#fff8f8;border:1px solid #f5c6c6;border-radius:8px;padding:12px 14px;display:flex;flex-direction:column;gap:10px}
.disc-numeral-row{display:flex;gap:10px}
.disc-n{font-weight:700;color:var(--a);flex-shrink:0}
.disc-check{display:flex;align-items:flex-start;gap:10px;background:#f4f6f9;border-radius:8px;padding:12px 14px;margin-top:12px}
.disc-check input[type=checkbox]{width:16px;height:16px;margin-top:2px;flex-shrink:0;accent-color:var(--p);cursor:pointer}
.disc-check label{font-size:11px;font-weight:600;color:var(--p);cursor:pointer;line-height:1.5}
.disc-footer{padding:14px 22px;border-top:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;gap:12px;background:#fafbfc}
.disc-footer p{font-size:10px;color:var(--m);flex:1}
#discAcceptBtn{background:var(--p);color:#fff;border:none;border-radius:8px;padding:10px 22px;font-size:12px;font-weight:700;cursor:pointer;opacity:.4;pointer-events:none;transition:all .25s;white-space:nowrap}
#discAcceptBtn.ready{opacity:1;pointer-events:auto}
#discAcceptBtn.ready:hover{background:#254d7a}

/* â•â• HEADER â•â• */
header{background:var(--p);color:#fff;padding:0 14px;height:52px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.logo{display:flex;align-items:center;gap:9px}
.logo-icon{width:32px;height:32px;background:var(--a);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:16px}
.logo h1{font-size:13px;font-weight:700}.logo p{font-size:9px;opacity:.7}
.hright{display:flex;align-items:center;gap:8px}
.hbadges{display:flex;gap:4px;flex-wrap:wrap}
.hbadge{background:rgba(255,255,255,.13);border:1px solid rgba(255,255,255,.22);border-radius:20px;padding:2px 7px;font-size:9px}
.offline-btn{display:flex;align-items:center;gap:5px;background:rgba(255,255,255,.13);border:1px solid rgba(255,255,255,.28);border-radius:20px;padding:3px 10px;color:#fff;font-size:10px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .2s}
.odot{width:7px;height:7px;border-radius:50%;background:#4caf50}

/* â•â• LAYOUT â•â• */
main{flex:1;display:flex;overflow:hidden}
aside{width:188px;background:var(--card);border-right:1px solid var(--b);display:flex;flex-direction:column;padding:8px 7px;gap:2px;flex-shrink:0;overflow-y:auto}
aside::-webkit-scrollbar{width:3px}aside::-webkit-scrollbar-thumb{background:#ccc;border-radius:2px}
.new-btn{background:var(--p);color:#fff;border:none;border-radius:6px;padding:7px 9px;cursor:pointer;font-size:11px;font-weight:700;display:flex;align-items:center;gap:5px;margin-bottom:3px;width:100%}
.new-btn:hover{background:#254d7a}
.slabel{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--m);padding:4px 6px;margin-top:3px}
.sitem{padding:6px 8px;border-radius:6px;cursor:pointer;font-size:11px;color:var(--t);border:1px solid transparent;transition:all .15s;display:flex;align-items:center;gap:6px;line-height:1.3}
.sitem:hover{background:var(--bg);border-color:var(--b)}
.sitem.active{background:#eaf0f8;border-color:#b8ccde;color:var(--p);font-weight:600}
.dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}

/* â•â• CONTENT â•â• */
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
.topbar{display:flex;border-bottom:2px solid var(--b);background:var(--card);flex-shrink:0;overflow-x:auto}
.topbar::-webkit-scrollbar{height:2px}.topbar::-webkit-scrollbar-thumb{background:#ccc}
.ttab{padding:9px 12px;font-size:11px;font-weight:600;cursor:pointer;color:var(--m);border-bottom:3px solid transparent;margin-bottom:-2px;white-space:nowrap;transition:all .15s}
.ttab.active{color:var(--p);border-bottom-color:var(--p)}
.view{flex:1;display:none;flex-direction:column;overflow:hidden}
.view.show{display:flex}

/* â•â• CHAT â•â• */
.chat-toolbar{display:flex;justify-content:flex-end;align-items:center;gap:8px;padding:6px 16px;background:var(--card);border-bottom:1px solid var(--b);flex-shrink:0}
.save-chat-btn{display:flex;align-items:center;gap:5px;background:none;border:1px solid var(--b);border-radius:20px;padding:4px 12px;font-size:10px;font-weight:600;color:var(--m);cursor:pointer;transition:all .2s}
.save-chat-btn:hover{border-color:var(--p);color:var(--p)}
.msgs{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
.msgs::-webkit-scrollbar{width:4px}.msgs::-webkit-scrollbar-thumb{background:#ccc;border-radius:2px}
.welcome{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:24px;text-align:center}
.welcome h2{font-size:17px;font-weight:700;color:var(--p)}
.welcome p{color:var(--m);max-width:440px;font-size:12px;line-height:1.6}
.suggs{display:grid;grid-template-columns:1fr 1fr;gap:7px;width:100%;max-width:520px}
.sugg{background:var(--card);border:1px solid var(--b);border-radius:9px;padding:10px 12px;cursor:pointer;font-size:11px;text-align:left;line-height:1.4;transition:all .15s}
.sugg:hover{border-color:var(--p);background:#eaf0f8;color:var(--p)}
.sugg strong{display:block;font-size:9px;text-transform:uppercase;letter-spacing:.5px;color:var(--m);margin-bottom:2px}
.msg{display:flex;gap:8px;max-width:720px}
.msg.user{flex-direction:row-reverse;align-self:flex-end}
.msg.bot{align-self:flex-start}
.av{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.av.ba{background:var(--p);color:#fff}.av.ua{background:var(--a);color:#fff;font-size:10px;font-weight:700}
.bubble{padding:10px 14px;border-radius:13px;font-size:12px;line-height:1.65;max-width:560px}
.msg.user .bubble{background:var(--p);color:#fff;border-bottom-right-radius:4px}
.msg.bot .bubble{background:var(--card);border:1px solid var(--b);border-bottom-left-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.typing{display:flex;gap:4px;align-items:center;padding:10px 14px}
.typing span{width:6px;height:6px;border-radius:50%;background:#b0bec5;animation:bounce 1.2s infinite}
.typing span:nth-child(2){animation-delay:.2s}.typing span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}
.inp-area{padding:10px 16px 12px;background:var(--card);border-top:1px solid var(--b)}
.inp-wrap{display:flex;align-items:flex-end;gap:7px;background:var(--bg);border:2px solid var(--b);border-radius:11px;padding:6px 6px 6px 12px;transition:border-color .2s}
.inp-wrap:focus-within{border-color:var(--p)}
textarea{flex:1;border:none;background:transparent;resize:none;font-size:12px;line-height:1.5;font-family:inherit;color:var(--t);max-height:90px;outline:none}
textarea::placeholder{color:var(--m)}
.sbtn{width:30px;height:30px;border-radius:7px;background:var(--p);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.sbtn:hover{background:#254d7a}.sbtn:disabled{background:#ccc;cursor:not-allowed}
.hint{font-size:9px;color:var(--m);text-align:center;margin-top:5px}

/* â•â• PANELES â•â• */
.panel-header{padding:11px 16px;background:var(--card);border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;gap:10px}
.panel-header h2{font-size:13px;font-weight:700;color:var(--p)}
.panel-header p{font-size:10px;color:var(--m)}
.search-box{display:flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--b);border-radius:7px;padding:5px 10px;flex:1;max-width:260px}
.search-box input{border:none;background:transparent;font-size:11px;outline:none;color:var(--t);width:100%}
.panel-body{flex:1;display:flex;overflow:hidden}
.nav-col{width:180px;border-right:1px solid var(--b);overflow-y:auto;padding:7px 5px;flex-shrink:0;background:#fafbfc}
.nav-col::-webkit-scrollbar{width:3px}.nav-col::-webkit-scrollbar-thumb{background:#ccc}
.nbtn{width:100%;text-align:left;padding:7px 8px;border-radius:6px;border:none;background:none;cursor:pointer;font-size:10px;font-weight:600;color:var(--t);margin-bottom:2px;line-height:1.3;transition:all .15s}
.nbtn span{display:block;font-size:9px;font-weight:400;opacity:.7;margin-top:1px}
.nbtn:hover{background:#eaf0f8;color:var(--p)}.nbtn.active{background:var(--p);color:#fff}
.main-col{flex:1;overflow-y:auto;padding:16px}
.ley-title{font-size:14px;font-weight:700;color:var(--p);margin-bottom:3px}
.ley-sub{font-size:11px;color:var(--m);margin-bottom:14px}
.tit-title{font-size:12px;font-weight:700;color:var(--t);margin:14px 0 7px;padding-bottom:5px;border-bottom:2px solid var(--a)}
.art-card{background:var(--card);border:1px solid var(--b);border-radius:9px;padding:11px 13px;margin-bottom:7px;transition:box-shadow .15s}
.art-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.07)}
.art-num{font-size:10px;font-weight:700;color:var(--a);text-transform:uppercase;margin-bottom:3px}
.art-text{font-size:12px;line-height:1.6;color:var(--t)}
.consult-btn{font-size:10px;color:var(--p);background:#eaf0f8;border:none;border-radius:4px;padding:3px 8px;cursor:pointer;margin-top:6px;font-weight:600}
.consult-btn:hover{background:#d0e3f3}

/* â•â• CONTRALORÃA â•â• */
.ctr-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px;padding:16px;overflow-y:auto}
.ctr-card{background:var(--card);border:1px solid var(--b);border-radius:10px;padding:13px 14px;transition:all .15s}
.ctr-card:hover{box-shadow:0 3px 10px rgba(0,0,0,.08);border-color:#e8b4b4}
.ctr-num{font-size:10px;font-weight:700;color:var(--a);margin-bottom:3px}
.ctr-mat{font-size:12px;font-weight:600;color:var(--p);margin-bottom:5px;line-height:1.3}
.ctr-res{font-size:11px;color:var(--m);line-height:1.5}
.ctr-tags{display:flex;gap:4px;margin-top:7px;flex-wrap:wrap}
.ctag{background:#fde8e8;color:#922b21;border-radius:4px;font-size:9px;font-weight:600;padding:2px 5px}

/* â•â• CALCULADORA â•â• */
.two-col{flex:1;overflow-y:auto;padding:16px;display:flex;gap:14px}
.form-card{background:var(--card);border:1px solid var(--b);border-radius:11px;padding:16px;flex:1;max-width:420px}
.form-card h3{font-size:13px;font-weight:700;color:var(--p);margin-bottom:3px}
.form-card>p{font-size:11px;color:var(--m);margin-bottom:14px}
.result-card{background:var(--card);border:1px solid var(--b);border-radius:11px;padding:16px;flex:1}
.result-card h3{font-size:13px;font-weight:700;color:var(--p);margin-bottom:12px}
.fgroup{margin-bottom:11px}
.fgroup label{display:block;font-size:11px;font-weight:600;color:var(--t);margin-bottom:4px}
.fgroup input,.fgroup select,.fgroup textarea{width:100%;padding:7px 10px;border:1px solid var(--b);border-radius:7px;font-size:12px;color:var(--t);background:var(--bg);outline:none;transition:border-color .2s;font-family:inherit}
.fgroup input:focus,.fgroup select:focus,.fgroup textarea:focus{border-color:var(--p)}
.fgroup textarea{resize:vertical;min-height:65px}
.fgroup input.input-error{border-color:var(--a);background:#fff5f5}
.field-error{font-size:10px;color:var(--a);margin-top:3px;display:none}
.field-error.show{display:block}
.action-btn{width:100%;background:var(--p);color:#fff;border:none;border-radius:7px;padding:9px;font-size:12px;font-weight:700;cursor:pointer;margin-top:3px}
.action-btn:hover{background:#254d7a}
.action-btn.red{background:var(--a)}.action-btn.red:hover{background:#a93226}
.action-btn.green{background:var(--g)}.action-btn.green:hover{background:#1e8449}
.res-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--bg)}
.res-label{font-size:11px;color:var(--m)}.res-val{font-size:12px;font-weight:600;color:var(--t)}
.res-total{background:#eaf0f8;border-radius:8px;padding:12px;margin-top:10px;text-align:center}
.res-total .amount{font-size:20px;font-weight:700;color:var(--p)}
.res-total p{font-size:10px;color:var(--m);margin-top:2px}
.res-tope{background:#fff3cd;border:1px solid #ffc107;border-radius:6px;padding:6px 10px;font-size:10px;color:#856404;margin-top:6px}
.art-ref{font-size:10px;color:var(--m);background:var(--bg);border-radius:5px;padding:5px 9px;margin-top:8px;line-height:1.5}
.calc-disclaimer{background:#fff3cd;border:1px solid #ffc107;border-radius:7px;padding:8px 12px;font-size:10px;color:#856404;margin-top:10px;line-height:1.5}
.empty-box{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:180px;color:var(--m);font-size:12px;gap:8px;text-align:center}
.dl-btn-row{display:flex;gap:7px;margin-top:8px;flex-wrap:wrap}
.dl-btn{background:#eaf0f8;color:var(--p);border:1px solid #b8ccde;border-radius:6px;padding:6px 12px;font-size:10px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:5px}
.dl-btn:hover{background:#d0e3f3}
.dl-btn.word{background:#e8f4fd;color:#2b579a;border-color:#b8d4ed}
.dl-btn.word:hover{background:#cce4f7}

/* â•â• ALERTAS â•â• */
.alertas-list{flex:1;overflow-y:auto;padding:14px 16px;display:flex;flex-direction:column;gap:10px}
.alerta-card{background:var(--card);border:1px solid var(--b);border-radius:10px;padding:14px}
.alerta-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:7px}
.alerta-badge{font-size:9px;font-weight:700;padding:3px 8px;border-radius:20px;white-space:nowrap;flex-shrink:0}
.badge-cambio{background:#fde8e8;color:#922b21}.badge-nuevo{background:#d4efdf;color:#1d6a3a}.badge-ratifica{background:#eaf0f8;color:var(--p)}
.alerta-tribunal{font-size:9px;color:var(--m);margin-bottom:2px}
.alerta-titulo{font-size:12px;font-weight:700;color:var(--p);line-height:1.35;margin-bottom:7px}
.alerta-tldr{font-size:11px;color:var(--t);line-height:1.6;background:var(--bg);border-left:3px solid var(--a);border-radius:0 6px 6px 0;padding:8px 11px;margin-bottom:8px}
.alerta-footer{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.materia-tag{background:#eaf0f8;color:var(--p);border-radius:4px;font-size:9px;font-weight:600;padding:2px 6px}
.alerta-fecha{font-size:9px;color:var(--m);margin-left:auto}
.citar-btn{background:var(--p);color:#fff;border:none;border-radius:5px;padding:4px 10px;font-size:10px;font-weight:700;cursor:pointer}
.citar-btn.copied{background:var(--g)}
.prefs-inner{padding:12px 16px;background:#fafbfc;border-bottom:1px solid var(--b)}
.prefs-chips{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0 12px}
.pchip{padding:5px 11px;border-radius:20px;border:2px solid var(--b);background:var(--card);font-size:10px;font-weight:600;cursor:pointer;transition:all .15s;color:var(--t)}
.pchip.sel{background:var(--p);color:#fff;border-color:var(--p)}

/* â•â• SUBTABS â•â• */
.subtab-bar{display:flex;gap:6px;padding:10px 16px;background:var(--card);border-bottom:1px solid var(--b);flex-shrink:0;flex-wrap:wrap}
.stab{padding:6px 14px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--b);color:var(--m);background:var(--bg);transition:all .15s}
.stab.active{background:var(--p);color:#fff;border-color:var(--p)}

/* â•â• ESCRITOS / RECLAMOS â•â• */
.escritos-wrap,.reclamos-wrap{flex:1;overflow-y:auto;padding:14px;display:flex;gap:12px}
.escrito-types,.reclamo-nav{width:185px;flex-shrink:0;display:flex;flex-direction:column;gap:5px;overflow-y:auto}
.etype-card,.reclamo-card{background:var(--card);border:1px solid var(--b);border-radius:8px;padding:10px;cursor:pointer;transition:all .15s}
.etype-card:hover,.etype-card.active,.reclamo-card:hover,.reclamo-card.active{border-color:var(--p);background:#eaf0f8}
.etype-card.active,.reclamo-card.active{border-width:2px}
.etype-icon,.reclamo-icon{font-size:19px;margin-bottom:4px}
.etype-name,.reclamo-name{font-size:11px;font-weight:600;color:var(--p)}
.etype-desc,.reclamo-dest{font-size:10px;color:var(--m);margin-top:2px;line-height:1.3}
.escrito-form{flex:1;background:var(--card);border:1px solid var(--b);border-radius:11px;padding:14px;display:flex;flex-direction:column;gap:9px;overflow-y:auto}
.escrito-form h3{font-size:13px;font-weight:700;color:var(--p)}
.efield{display:flex;flex-direction:column;gap:3px}
.efield label{font-size:10px;font-weight:600;color:var(--t)}
.efield input,.efield textarea,.efield select{padding:7px 10px;border:1px solid var(--b);border-radius:7px;font-size:11px;color:var(--t);background:var(--bg);outline:none;font-family:inherit}
.efield input:focus,.efield textarea:focus,.efield select:focus{border-color:var(--p)}
.efield textarea{resize:vertical;min-height:65px}
.gen-btn{background:var(--a);color:#fff;border:none;border-radius:7px;padding:8px 14px;font-size:11px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;align-self:flex-start}
.gen-btn:hover{background:#a93226}.gen-btn:disabled{background:#ccc;cursor:not-allowed}
.escrito-output{flex:1;background:var(--card);border:1px solid var(--b);border-radius:11px;padding:14px;display:flex;flex-direction:column;gap:8px;min-width:0;overflow:hidden}
.escrito-output h3{font-size:12px;font-weight:700;color:var(--p);flex-shrink:0}
.output-area{flex:1;overflow-y:auto;font-size:11px;line-height:1.7;color:var(--t);white-space:pre-wrap;background:var(--bg);border-radius:7px;padding:12px;font-family:'Courier New',monospace}
.output-area::-webkit-scrollbar{width:4px}.output-area::-webkit-scrollbar-thumb{background:#ccc}
.copy-btn{background:#eaf0f8;color:var(--p);border:none;border-radius:6px;padding:6px 12px;font-size:10px;font-weight:600;cursor:pointer;align-self:flex-start;flex-shrink:0}
.copy-btn:hover{background:#d0e3f3}

/* â•â• TRIBUNAL / SUMARIOS â•â• */
.trib-wrap{flex:1;display:flex;gap:12px;padding:14px;overflow-y:auto}
.trib-form{width:320px;flex-shrink:0;background:var(--card);border:1px solid var(--b);border-radius:11px;padding:16px;display:flex;flex-direction:column;gap:10px}
.trib-form h3{font-size:13px;font-weight:700}
.trib-form>p{font-size:11px;color:var(--m);margin-top:-6px}
.trib-result{flex:1;background:var(--card);border:1px solid var(--b);border-radius:11px;padding:16px;display:flex;flex-direction:column;gap:8px;overflow:hidden}
.trib-result h3{font-size:12px;font-weight:700;flex-shrink:0}
.trib-output{flex:1;overflow-y:auto;font-size:12px;line-height:1.7}
.trib-output::-webkit-scrollbar{width:4px}.trib-output::-webkit-scrollbar-thumb{background:#ccc}

/* â•â• CORTES â•â• */
.cortes-wrap{flex:1;display:flex;gap:12px;padding:14px;overflow-y:auto}
.cortes-left{width:270px;flex-shrink:0;display:flex;flex-direction:column;gap:10px}
.cortes-right{flex:1;background:var(--card);border:1px solid var(--b);border-radius:11px;padding:14px;display:flex;flex-direction:column;gap:8px;overflow:hidden}
.cortes-right h3{font-size:12px;font-weight:700;color:var(--p);flex-shrink:0}
.cortes-output{flex:1;overflow-y:auto;font-size:12px;line-height:1.7}
.corte-selector,.materia-selector{background:var(--card);border:1px solid var(--b);border-radius:10px;padding:14px}
.corte-selector h4,.materia-selector h4{font-size:12px;font-weight:700;color:var(--p);margin-bottom:8px}
.corte-btns{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.corte-btn{padding:6px 8px;border-radius:6px;border:1px solid var(--b);background:var(--bg);font-size:10px;cursor:pointer;text-align:center;transition:all .15s;color:var(--t);font-weight:500}
.corte-btn:hover{border-color:var(--p);color:var(--p)}.corte-btn.active{background:var(--p);color:#fff;border-color:var(--p)}

/* â•â• MISC â•â• */
.spinner{display:inline-block;width:13px;height:13px;border:2px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.no-res{text-align:center;color:var(--m);padding:24px;font-size:12px}

/* â•â• RESPONSIVE MÃ“VIL â•â• */
@media (max-width:768px){
  main{flex-direction:column}
  aside{width:100%;max-height:80px;flex-direction:row;overflow-x:auto;overflow-y:hidden;border-right:none;border-bottom:1px solid var(--b);padding:6px 8px;gap:5px;align-items:center;-webkit-overflow-scrolling:touch;scroll-snap-type:x mandatory}
  aside::-webkit-scrollbar{display:none}
  .new-btn{white-space:nowrap;flex-shrink:0;width:auto;padding:6px 10px;font-size:10px}
  .sitem{white-space:nowrap;flex-shrink:0;padding:5px 10px;font-size:10px;scroll-snap-align:start}
  .slabel{display:none}
  [data-qk]{display:none}
  .msg{max-width:95%}
  header{padding:0 10px;height:48px}
  .hbadges{display:none}
  .logo h1{font-size:12px}
  .topbar{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .topbar::-webkit-scrollbar{display:none}
  .ttab{font-size:10px;padding:8px 9px}
  .two-col{flex-direction:column;padding:10px;gap:10px}
  .form-card,.result-card{max-width:100%}
  .trib-wrap{flex-direction:column;padding:10px;gap:10px}
  .trib-form{width:100%}
  .escritos-wrap,.reclamos-wrap{flex-direction:column;padding:10px;gap:10px}
  .escrito-types,.reclamo-nav{width:100%;flex-direction:row;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:6px}
  .etype-card,.reclamo-card{flex-shrink:0;width:130px}
  .ctr-grid{grid-template-columns:1fr;padding:10px}
  .cortes-wrap{flex-direction:column;padding:10px}
  .cortes-left{width:100%}
  .corte-btns{grid-template-columns:repeat(3,1fr)}
  #disclaimerBox{max-width:100%;border-radius:10px}
  .disc-body{max-height:60vh;padding:14px}
  .disc-footer{flex-direction:column;gap:8px;align-items:stretch}
  #discAcceptBtn{width:100%;text-align:center}
  .inp-area{padding:8px 10px 10px}
  .msgs{padding:10px}
  .dl-btn-row{flex-direction:column}
}
</style>
</head>
<body>

<!-- â•â• DISCLAIMER â•â• -->
<div id="disclaimerOverlay">
  <div id="disclaimerBox">
    <div class="disc-header">
      <div class="disc-icon">âš–ï¸</div>
      <div><h2>TÃ©rminos de Uso y ExenciÃ³n de Responsabilidad Legal</h2><p>Lea atentamente antes de continuar</p></div>
    </div>
    <div class="disc-body">
      <div class="disc-section">
        <h3>ğŸ“Œ DeclaraciÃ³n de Naturaleza Referencial</h3>
        <p>Jurisbot es una herramienta tecnolÃ³gica diseÃ±ada <strong>exclusivamente con fines informativos y de simulaciÃ³n referencial</strong>. Los resultados, cÃ¡lculos de indemnizaciones y datos proporcionados <strong>no constituyen, bajo ninguna circunstancia, asesorÃ­a legal, laboral, judicial o profesional vinculante</strong>. Para decisiones definitivas consulte a un abogado habilitado.</p>
      </div>
      <div class="disc-section">
        <h3>âš–ï¸ ExenciÃ³n de Responsabilidad y Renuncia de Acciones Legales</h3>
        <p style="margin-bottom:10px">Al presionar <strong>"Aceptar y Continuar"</strong>, usted declara entender y consentir expresamente:</p>
        <div class="disc-numeral">
          <div class="disc-numeral-row"><span class="disc-n">1.</span><div><strong>LÃ­mite de la Herramienta:</strong> Los cÃ¡lculos son estimaciones automatizadas que <strong>no garantizan precisiÃ³n absoluta</strong> ante cambios legislativos, interpretaciones jurisprudenciales o particularidades de cada caso.</div></div>
          <div class="disc-numeral-row"><span class="disc-n">2.</span><div><strong>LiberaciÃ³n de Responsabilidad:</strong> El usuario asume a su entero riesgo el uso de la informaciÃ³n. Los creadores, desarrolladores y administradores de Jurisbot quedan <strong>exentos de toda responsabilidad civil, penal o administrativa</strong> por errores, omisiones o inexactitudes.</div></div>
          <div class="disc-numeral-row"><span class="disc-n">3.</span><div><strong>Renuncia Expresa:</strong> El usuario <strong>renuncia irrevocablemente</strong> a iniciar cualquier acciÃ³n legal, demanda, querella o reclamaciÃ³n contra los creadores y titulares de Jurisbot por daÃ±os directos, indirectos, perjuicios o lucro cesante derivados del uso de esta aplicaciÃ³n.</div></div>
        </div>
      </div>
      <div class="disc-check">
        <input type="checkbox" id="discCheck" onchange="toggleDiscCheck(this.checked)">
        <label for="discCheck">Acepto los TÃ©rminos de Uso y la ExenciÃ³n de Responsabilidad Legal.</label>
      </div>
    </div>
    <div class="disc-footer">
      <p>Debe marcar la casilla para poder continuar.</p>
      <button id="discAcceptBtn" onclick="acceptDisclaimer()">âœ… Aceptar y Continuar</button>
    </div>
  </div>
</div>

<header>
  <div class="logo">
    <div class="logo-icon">âš–ï¸</div>
    <div><h1>JurisBot Laboral Chile</h1><p>Plataforma jurÃ­dica laboral integral</p></div>
  </div>
  <div class="hright">
    <div class="hbadges">
      <span class="hbadge">ğŸ“– CT</span><span class="hbadge">ğŸ›¡ï¸ 16.744</span><span class="hbadge">ğŸ¤ 20.940</span>
      <span class="hbadge">ğŸ›ï¸ PJUD</span><span class="hbadge">ğŸ”´ CGR</span><span class="hbadge">ğŸ¥ SUSESO</span>
    </div>
    <button class="offline-btn" id="offlineToggle"><span class="odot" id="odot"></span><span id="olabel">Online</span></button>
  </div>
</header>

<main>
<aside>
  <button class="new-btn" id="btnNewChat">âœï¸ Nueva consulta</button>
  <div class="slabel">MÃ³dulos</div>
  <div class="sitem active" id="sb0" data-view="chat" data-vi="0">ğŸ’¬ Chat jurÃ­dico</div>
  <div class="sitem" id="sb1" data-view="norm" data-vi="1">ğŸ“– Normativa</div>
  <div class="sitem" id="sb2" data-view="ctr" data-vi="2">ğŸ”´ ContralorÃ­a</div>
  <div class="sitem" id="sb3" data-view="calc" data-vi="3">ğŸ§® Calculadora</div>
  <div class="sitem" id="sb4" data-view="caso" data-vi="4">ğŸ” AnÃ¡lisis caso</div>
  <div class="sitem" id="sb5" data-view="escritos" data-vi="5">âœï¸ Escritos</div>
  <div class="sitem" id="sb6" data-view="alertas" data-vi="6">ğŸ”” Alertas</div>
  <div class="sitem" id="sb7" data-view="sumarios" data-vi="7">ğŸ—‚ï¸ Sumarios/Lic.</div>
  <div class="sitem" id="sb8" data-view="tribunal" data-vi="8">âš–ï¸ Vista Tribunal</div>
  <div class="sitem" id="sb9" data-view="cortes" data-vi="9">ğŸ—ºï¸ Criterios Corte</div>
  <div class="sitem" id="sb10" data-view="reclamos" data-vi="10">ğŸ“¨ Reclamos</div>
  <div class="slabel">Filtro fuente</div>
  <div class="sitem active" id="f0" data-filter="all" data-fi="0"><span class="dot" style="background:var(--a)"></span>Todas</div>
  <div class="sitem" id="f1" data-filter="pjud" data-fi="1"><span class="dot" style="background:#2980b9"></span>Poder Judicial</div>
  <div class="sitem" id="f2" data-filter="dt" data-fi="2"><span class="dot" style="background:var(--g)"></span>Dir. del Trabajo</div>
  <div class="sitem" id="f3" data-filter="tc" data-fi="3"><span class="dot" style="background:#8e44ad"></span>T. Constitucional</div>
  <div class="sitem" id="f4" data-filter="ctr" data-fi="4"><span class="dot" style="background:var(--a)"></span>ContralorÃ­a</div>
  <div class="slabel">Accesos rÃ¡pidos</div>
  <div class="sitem" data-qk="despido">ğŸ“Œ Despido injustificado</div>
  <div class="sitem" data-qk="acoso">ğŸ“Œ Acoso laboral</div>
  <div class="sitem" data-qk="tutela">ğŸ“Œ Tutela laboral</div>
  <div class="sitem" data-qk="accidente">ğŸ“Œ Accidentes trabajo</div>
  <div class="sitem" data-qk="huelga">ğŸ“Œ NegociaciÃ³n colectiva</div>
  <div class="sitem" data-qk="honorarios">ğŸ“Œ Honorarios pÃºblicos</div>
</aside>

<div class="content">
  <div class="topbar">
    <div class="ttab active" id="tt0" data-view="chat" data-vi="0">ğŸ’¬ Chat</div>
    <div class="ttab" id="tt1" data-view="norm" data-vi="1">ğŸ“– Normativa</div>
    <div class="ttab" id="tt2" data-view="ctr" data-vi="2">ğŸ”´ CGR</div>
    <div class="ttab" id="tt3" data-view="calc" data-vi="3">ğŸ§® Calc.</div>
    <div class="ttab" id="tt4" data-view="caso" data-vi="4">ğŸ” Caso</div>
    <div class="ttab" id="tt5" data-view="escritos" data-vi="5">âœï¸ Escritos</div>
    <div class="ttab" id="tt6" data-view="alertas" data-vi="6">ğŸ”” Alertas</div>
    <div class="ttab" id="tt7" data-view="sumarios" data-vi="7">ğŸ—‚ï¸ Sumarios</div>
    <div class="ttab" id="tt8" data-view="tribunal" data-vi="8">âš–ï¸ Tribunal</div>
    <div class="ttab" id="tt9" data-view="cortes" data-vi="9">ğŸ—ºï¸ Cortes</div>
    <div class="ttab" id="tt10" data-view="reclamos" data-vi="10">ğŸ“¨ Reclamos</div>
  </div>

  <!-- CHAT -->
  <div class="view show" id="vChat">
    <div class="chat-toolbar">
      <button class="save-chat-btn" id="saveChatBtn">ğŸ“¥ Guardar Chat</button>
    </div>
    <div class="msgs" id="msgs"></div>
    <div class="inp-area">
      <div class="inp-wrap">
        <textarea id="inp" rows="1" placeholder="Consulta sobre normativa o jurisprudencia laboral chilena..."></textarea>
        <button class="sbtn" id="sndBtn">â¤</button>
      </div>
      <p class="hint">Verifique siempre en pjud.cl Â· dt.gob.cl Â· contraloria.cl</p>
    </div>
  </div>

  <!-- NORMATIVA -->
  <div class="view" id="vNorm">
    <div class="panel-header">
      <div><h2>ğŸ“– Normativa Laboral Chilena</h2><p>CT Â· Ley 16.744 Â· Ley 20.940 Â· Estatuto Adm.</p></div>
      <div class="search-box"><span style="color:var(--m)">ğŸ”</span><input type="text" id="normSearch" placeholder="Buscar artÃ­culo o materia..."></div>
    </div>
    <div class="panel-body">
      <div class="nav-col" id="normNav"></div>
      <div class="main-col" id="artsPanel"></div>
    </div>
  </div>

  <!-- CONTRALORÃA -->
  <div class="view" id="vCtr">
    <div class="panel-header">
      <div><h2>ğŸ”´ DictÃ¡menes de ContralorÃ­a</h2><p>Materia laboral y funciÃ³n pÃºblica</p></div>
      <div class="search-box"><span style="color:var(--m)">ğŸ”</span><input type="text" id="ctrSearch" placeholder="Buscar dictamen..."></div>
    </div>
    <div class="ctr-grid" id="ctrGrid"></div>
  </div>

  <!-- CALCULADORA -->
  <div class="view" id="vCalc">
    <div class="two-col">
      <div class="form-card">
        <h3>ğŸ§® Calculadora de Indemnizaciones</h3>
        <p>Arts. 162, 163 y 168 CT Â· Tope: 90 UF</p>
        <div class="fgroup"><label>Tipo de tÃ©rmino</label>
          <select id="cTipo">
            <option value="nec">Necesidades de la empresa (art. 161)</option>
            <option value="inj">Despido injustificado (art. 168 a) +30%</option>
            <option value="inv">Despido indebido (art. 168 b) +50%</option>
            <option value="ind">Autodespido (art. 171) +80%</option>
          </select>
        </div>
        <div class="fgroup">
          <label>Ãšltima remuneraciÃ³n mensual ($)</label>
          <input type="text" id="cRem" inputmode="numeric" pattern="[0-9\.\,\$\s]*" placeholder="ej: 1.500.000" autocomplete="off" maxlength="15">
          <span class="field-error" id="errRem">Ingrese una remuneraciÃ³n vÃ¡lida mayor a $0</span>
        </div>
        <div class="fgroup"><label>AÃ±os de servicio</label>
          <input type="number" id="cAnios" placeholder="ej: 5" min="1" max="50">
          <span class="field-error" id="errAnios">Ingrese entre 1 y 50 aÃ±os</span>
        </div>
        <div class="fgroup"><label>Meses de fracciÃ³n (0â€“11)</label>
          <input type="number" id="cMeses" placeholder="ej: 6" min="0" max="11" value="0">
          <span class="field-error" id="errMeses">Ingrese entre 0 y 11 meses</span>
        </div>
        <div class="fgroup"><label>Vacaciones proporcionales (dÃ­as hÃ¡biles)</label>
          <input type="number" id="cVacProp" placeholder="ej: 8" min="0" max="25" value="0">
          <span class="field-error" id="errVac">Ingrese entre 0 y 25 dÃ­as</span>
        </div>
        <div class="fgroup"><label>Valor UF actual ($)</label>
          <input type="number" id="cUF" placeholder="ej: 38500" min="1">
          <span style="font-size:10px;color:var(--m);margin-top:2px;display:block">Consulte el valor vigente en cmfchile.cl</span>
        </div>
        <div class="fgroup"><label>Aviso previo</label>
          <select id="cAviso">
            <option value="no">No recibiÃ³ aviso â€” sustitutiva procede</option>
            <option value="si">SÃ­ recibiÃ³ aviso (30 dÃ­as)</option>
          </select>
        </div>
        <button class="action-btn" id="calcBtn">Calcular indemnizaciÃ³n</button>
      </div>
      <div class="result-card">
        <h3>ğŸ“Š Resultado estimado</h3>
        <div id="calcOut"><div class="empty-box"><span style="font-size:30px">ğŸ§®</span><span>Complete los datos para calcular</span></div></div>
      </div>
    </div>
  </div>

  <!-- ANÃLISIS DE CASO -->
  <div class="view" id="vCaso">
    <div class="trib-wrap">
      <div class="trib-form">
        <h3 style="color:var(--p)">ğŸ” AnÃ¡lisis de Caso</h3>
        <p style="color:var(--m);font-size:11px">Describa los hechos y obtenga orientaciÃ³n jurÃ­dica completa.</p>
        <div class="fgroup"><label>Tipo de parte</label>
          <select id="cParte"><option value="trabajador">Trabajador / Demandante</option><option value="empleador">Empleador / Demandado</option><option value="sindicato">Sindicato</option><option value="funcionario">Funcionario pÃºblico</option></select>
        </div>
        <div class="fgroup"><label>Ãrea del conflicto</label>
          <select id="cArea"><option>TÃ©rmino de contrato / Despido</option><option>Acoso laboral o sexual</option><option>Tutela de derechos fundamentales</option><option>Accidente del trabajo / Ley 16.744</option><option>Remuneraciones / Horas extra</option><option>Conflicto sindical</option><option>SubcontrataciÃ³n</option><option>FunciÃ³n pÃºblica / ContralorÃ­a</option><option>Otro</option></select>
        </div>
        <div class="fgroup"><label>DescripciÃ³n de los hechos</label>
          <textarea id="cHechos" rows="5" placeholder="QuÃ© ocurriÃ³, fechas, partes, documentos..."></textarea>
        </div>
        <div class="fgroup"><label>Objetivo (opcional)</label>
          <input type="text" id="cObj" placeholder="ej: reincorporaciÃ³n, indemnizaciÃ³n...">
        </div>
        <button class="action-btn" id="casoBtn">ğŸ” Analizar caso</button>
      </div>
      <div class="trib-result">
        <h3 style="color:var(--p)">ğŸ“‹ AnÃ¡lisis jurÃ­dico</h3>
        <div class="trib-output" id="casoOut"><div class="empty-box"><span style="font-size:30px">ğŸ”</span><span>Complete el formulario y presione analizar</span></div></div>
      </div>
    </div>
  </div>

  <!-- ESCRITOS -->
  <div class="view" id="vEscritos">
    <div class="escritos-wrap">
      <div class="escrito-types" id="eTypes"></div>
      <div class="escrito-form" id="eForm">
        <h3 id="eFormTitle">Seleccione un tipo de escrito</h3>
        <div id="eFields"></div>
        <button class="gen-btn" id="eGenBtn" style="display:none">âœï¸ Generar <span id="eSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="escrito-output">
        <h3>ğŸ“„ Escrito generado</h3>
        <div class="output-area" id="eOutput"><div class="empty-box"><span style="font-size:30px">âœï¸</span><span>El escrito aparecerÃ¡ aquÃ­</span></div></div>
        <div class="dl-btn-row">
          <button class="copy-btn" id="copyEscritoBtn">ğŸ“‹ Copiar texto</button>
          <button class="dl-btn word" id="wordEscritoBtn">ğŸ“„ Descargar Word</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ALERTAS -->
  <div class="view" id="vAlertas">
    <div class="panel-header">
      <div><h2>ğŸ”” Alertas de Jurisprudencia</h2><p id="alertaSubtitle">Novedades filtradas por tus materias</p></div>
      <button class="action-btn" style="width:auto;padding:6px 13px;font-size:11px;margin:0" id="prefsBtn">âš™ï¸ Mis materias</button>
    </div>
    <div id="prefsPanel" style="display:none">
      <div class="prefs-inner">
        <div style="font-size:11px;font-weight:700;color:var(--p);margin-bottom:3px">Selecciona tus materias de interÃ©s</div>
        <div class="prefs-chips" id="prefsChips"></div>
        <button class="action-btn green" style="width:auto;padding:6px 14px;font-size:11px;margin:0" id="prefsSaveBtn">Guardar</button>
      </div>
    </div>
    <div class="alertas-list" id="alertasList"></div>
  </div>

  <!-- SUMARIOS Y LICENCIAS -->
  <div class="view" id="vSumarios">
    <div class="subtab-bar">
      <div class="stab active" id="stab0" data-stab="0">ğŸ—‚ï¸ Defensa en Sumarios</div>
      <div class="stab" id="stab1" data-stab="1">ğŸ¥ ApelaciÃ³n de Licencias</div>
    </div>
    <div id="sumView0" class="trib-wrap">
      <div class="trib-form">
        <h3 style="color:var(--a)">ğŸ—‚ï¸ Estructurador de Descargos</h3>
        <p style="color:var(--m)">Genera descargos ante sumario administrativo (Ley 18.834).</p>
        <div class="fgroup"><label>Cargo / funciÃ³n</label><input type="text" id="s_cargo" placeholder="ej: Enfermera, Administrativo"></div>
        <div class="fgroup"><label>Servicio u organismo</label><input type="text" id="s_servicio" placeholder="ej: Hospital Regional"></div>
        <div class="fgroup"><label>Cargo(s) formulados</label><textarea id="s_cargos" rows="3" placeholder="Describa los cargos..."></textarea></div>
        <div class="fgroup"><label>Hechos segÃºn el funcionario</label><textarea id="s_hechos" rows="4" placeholder="VersiÃ³n del funcionario, fechas, testigos..."></textarea></div>
        <div class="fgroup"><label>Atenuantes o justificaciones</label><textarea id="s_atenuantes" rows="3" placeholder="Buena conducta anterior..."></textarea></div>
        <button class="action-btn red" id="sumariosBtn">ğŸ“ Generar descargos <span id="sumarSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="trib-result">
        <h3 style="color:var(--a)">ğŸ“‹ Descargos generados</h3>
        <div class="trib-output" id="sumOut"><div class="empty-box"><span style="font-size:30px">ğŸ—‚ï¸</span><span>Complete el formulario</span></div></div>
        <div class="dl-btn-row" style="margin-top:8px;flex-shrink:0">
          <button class="copy-btn" id="copySumBtn">ğŸ“‹ Copiar</button>
          <button class="dl-btn word" id="wordSumBtn">ğŸ“„ Descargar Word</button>
        </div>
      </div>
    </div>
    <div id="sumView1" style="display:none" class="trib-wrap">
      <div class="trib-form">
        <h3 style="color:var(--g)">ğŸ¥ ApelaciÃ³n de Licencia MÃ©dica</h3>
        <p style="color:var(--m)">Recurso ante COMPIN o SUSESO por rechazo de licencia.</p>
        <div class="fgroup"><label>Nombre del paciente</label><input type="text" id="l_nombre" placeholder="Nombre completo"></div>
        <div class="fgroup"><label>Tipo de licencia</label>
          <select id="l_tipo"><option value="enfermedad">Enfermedad comÃºn</option><option value="accidente">Accidente del trabajo</option><option value="maternal">Pre/post natal</option><option value="psiquiatrica">Enfermedad psiquiÃ¡trica</option></select>
        </div>
        <div class="fgroup"><label>Organismo que rechazÃ³</label>
          <select id="l_organismo"><option value="compin">COMPIN</option><option value="suseso">SUSESO</option><option value="isapre">ISAPRE</option><option value="mutualidad">Mutualidad</option></select>
        </div>
        <div class="fgroup"><label>Motivo de rechazo</label><textarea id="l_rechazo" rows="2" placeholder="ej: No acredita relaciÃ³n causal..."></textarea></div>
        <div class="fgroup"><label>DiagnÃ³stico mÃ©dico</label><input type="text" id="l_diagnostico" placeholder="ej: SÃ­ndrome depresivo mayor"></div>
        <div class="fgroup"><label>Antecedentes mÃ©dicos</label><textarea id="l_antecedentes" rows="3" placeholder="Tratamientos previos, mÃ©dico tratante..."></textarea></div>
        <button class="action-btn green" id="licenciaBtn">ğŸ“ Generar apelaciÃ³n <span id="licSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="trib-result">
        <h3 style="color:var(--g)">ğŸ“‹ Recurso generado</h3>
        <div class="trib-output" id="licOut"><div class="empty-box"><span style="font-size:30px">ğŸ¥</span><span>Complete el formulario</span></div></div>
        <div class="dl-btn-row" style="margin-top:8px;flex-shrink:0">
          <button class="copy-btn" id="copyLicBtn">ğŸ“‹ Copiar</button>
          <button class="dl-btn word" id="wordLicBtn">ğŸ“„ Descargar Word</button>
        </div>
      </div>
    </div>
  </div>

  <!-- VISTA TRIBUNAL -->
  <div class="view" id="vTribunal">
    <div class="subtab-bar">
      <div class="stab active" id="ttab0" data-ttab="0">ğŸ“‹ Estructurador de Resoluciones</div>
      <div class="stab" id="ttab1" data-ttab="1">ğŸ” Control de Congruencia</div>
    </div>
    <div id="tribView0" class="trib-wrap">
      <div class="trib-form">
        <h3 style="color:var(--purple)">ğŸ“‹ Estructurador de Resoluciones</h3>
        <p style="color:var(--m)">Borrador de fallos: Vistos, Considerandos y Resolutivo.</p>
        <div class="fgroup"><label>Tribunal</label><input type="text" id="tr_tribunal" placeholder="ej: 2do Juzgado Laboral de Santiago"></div>
        <div class="fgroup"><label>RIT / Rol</label><input type="text" id="tr_rol" placeholder="ej: O-1234-2024"></div>
        <div class="fgroup"><label>Procedimiento</label>
          <select id="tr_proc"><option>AplicaciÃ³n general (art. 446 CT)</option><option>Tutela laboral (art. 485 CT)</option><option>Monitorio (art. 496 CT)</option><option>EjecuciÃ³n laboral</option><option>Medida cautelar</option></select>
        </div>
        <div class="fgroup"><label>AcciÃ³n del demandante</label><textarea id="tr_accion" rows="2" placeholder="ej: Cobro prestaciones despido injustificado art. 168 CT"></textarea></div>
        <div class="fgroup"><label>Defensa del demandado</label><textarea id="tr_defensa" rows="2" placeholder="ej: Causal art. 160 N7..."></textarea></div>
        <div class="fgroup"><label>Hechos probados</label><textarea id="tr_hechos" rows="3" placeholder="Resume los hechos acreditados..."></textarea></div>
        <button class="action-btn" style="background:var(--purple)" id="tribBtn">âš–ï¸ Generar borrador <span id="tribSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="trib-result">
        <h3 style="color:var(--purple)">ğŸ“„ Borrador de resoluciÃ³n</h3>
        <div class="trib-output" id="tribOut"><div class="empty-box"><span style="font-size:30px">âš–ï¸</span><span>Complete el formulario</span></div></div>
        <div class="dl-btn-row" style="margin-top:8px;flex-shrink:0">
          <button class="copy-btn" id="copyTribBtn">ğŸ“‹ Copiar</button>
          <button class="dl-btn word" id="wordTribBtn">ğŸ“„ Descargar Word</button>
        </div>
      </div>
    </div>
    <div id="tribView1" style="display:none" class="trib-wrap">
      <div class="trib-form">
        <h3 style="color:var(--purple)">ğŸ” Control de Congruencia</h3>
        <p style="color:var(--m)">Verifica que todos los argumentos fueron abordados.</p>
        <div class="fgroup"><label>Argumentos del demandante</label><textarea id="cg_demandante" rows="4" placeholder="Argumentos de hecho y derecho..."></textarea></div>
        <div class="fgroup"><label>Argumentos del demandado</label><textarea id="cg_demandado" rows="4" placeholder="Argumentos de defensa..."></textarea></div>
        <div class="fgroup"><label>Borrador del fallo</label><textarea id="cg_fallo" rows="5" placeholder="Pegue aquÃ­ el borrador a revisar..."></textarea></div>
        <button class="action-btn" style="background:var(--purple)" id="congrBtn">ğŸ” Revisar <span id="congrSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="trib-result">
        <h3 style="color:var(--purple)">ğŸ“‹ Informe de congruencia</h3>
        <div class="trib-output" id="congrOut"><div class="empty-box"><span style="font-size:30px">ğŸ”</span><span>Complete los campos</span></div></div>
        <button class="copy-btn" id="copyCongrBtn" style="margin-top:8px;flex-shrink:0">ğŸ“‹ Copiar</button>
      </div>
    </div>
  </div>

  <!-- CRITERIOS POR CORTE -->
  <div class="view" id="vCortes">
    <div class="panel-header"><div><h2>ğŸ—ºï¸ Criterios por Corte de Apelaciones</h2><p>Tendencias jurisprudenciales por tribunal</p></div></div>
    <div class="cortes-wrap">
      <div class="cortes-left">
        <div class="corte-selector">
          <h4>Selecciona tu tribunal</h4>
          <div class="corte-btns" id="corteBtns"></div>
        </div>
        <div class="materia-selector">
          <h4>Materia a consultar</h4>
          <div class="fgroup"><select id="corteMateria">
            <option>Tutela laboral (art. 485 CT)</option><option>Despido injustificado</option>
            <option>Acoso laboral</option><option>Fuero maternal / desafuero</option>
            <option>Accidentes del trabajo</option><option>SubcontrataciÃ³n</option>
            <option>NegociaciÃ³n colectiva / huelga</option><option>Teletrabajo</option>
            <option>Honorarios sector pÃºblico</option>
          </select></div>
          <button class="action-btn" id="cortesBtn">ğŸ—ºï¸ Ver criterio local</button>
        </div>
      </div>
      <div class="cortes-right">
        <h3>ğŸ“Š Tendencia jurisprudencial local</h3>
        <div class="cortes-output" id="cortesOut"><div class="empty-box"><span style="font-size:30px">ğŸ—ºï¸</span><span>Selecciona una Corte y una materia</span></div></div>
      </div>
    </div>
  </div>

  <!-- RECLAMOS -->
  <div class="view" id="vReclamos">
    <div class="panel-header"><div><h2>ğŸ“¨ Gestor de Reclamos</h2><p>Isapre Â· Superintendencia Â· Dir. del Trabajo Â· SUSESO</p></div></div>
    <div class="reclamos-wrap">
      <div class="reclamo-nav" id="reclamoNav"></div>
      <div class="escrito-form" id="reclamoForm">
        <h3 id="reclamoTitle">Seleccione un tipo de reclamo</h3>
        <div id="reclamoFields"></div>
        <button class="gen-btn" id="reclamoGenBtn" style="display:none">ğŸ“¨ Generar reclamo <span id="reclamoSpin" style="display:none" class="spinner"></span></button>
      </div>
      <div class="escrito-output">
        <h3>ğŸ“„ Reclamo generado</h3>
        <div class="output-area" id="reclamoOut"><div class="empty-box"><span style="font-size:30px">ğŸ“¨</span><span>El reclamo aparecerÃ¡ aquÃ­</span></div></div>
        <div class="dl-btn-row">
          <button class="copy-btn" id="copyReclamoBtn">ğŸ“‹ Copiar texto</button>
          <button class="dl-btn word" id="wordReclamoBtn">ğŸ“„ Descargar Word</button>
        </div>
      </div>
    </div>
  </div>

</div><!-- /content -->
</main>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DISCLAIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleDiscCheck(checked){
  document.getElementById('discAcceptBtn').classList.toggle('ready',checked);
}
function acceptDisclaimer(){
  const o=document.getElementById('disclaimerOverlay');
  o.style.transition='opacity .3s';o.style.opacity='0';
  setTimeout(()=>o.remove(),300);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSISTENCIA EN MEMORIA (sesiÃ³n activa)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const formState={};
function trackField(id){
  const el=document.getElementById(id);if(!el)return;
  if(formState[id]!==undefined)el.value=formState[id];
  el.addEventListener('input',()=>{formState[id]=el.value;});
  el.addEventListener('change',()=>{formState[id]=el.value;});
}
function trackFields(ids){ids.forEach(trackField);}
const PERSISTENT_FIELDS=['cTipo','cRem','cAnios','cMeses','cVacProp','cUF','cAviso','cParte','cArea','cHechos','cObj','s_cargo','s_servicio','s_cargos','s_hechos','s_atenuantes','l_nombre','l_tipo','l_organismo','l_rechazo','l_diagnostico','l_antecedentes','tr_tribunal','tr_rol','tr_proc','tr_accion','tr_defensa','tr_hechos','cg_demandante','cg_demandado','cg_fallo','corteMateria'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MENSAJES DE CARGA DINÃMICOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LOADING_MSGS={
  default:  ['Procesando consulta...','Analizando jurisprudencia...','Estructurando respuesta...','Revisando normativa vigente...','Casi listo...'],
  caso:     ['Analizando los hechos del caso...','Identificando normas aplicables...','Revisando jurisprudencia relevante...','Evaluando estrategias procesales...','Estructurando el anÃ¡lisis jurÃ­dico...'],
  escrito:  ['Redactando el documento...','Aplicando formato jurÃ­dico chileno...','Incorporando citas legales...','Revisando coherencia procesal...','Finalizando el escrito...'],
  sumario:  ['Analizando los cargos formulados...','Estructurando los descargos...','Citando Estatuto Administrativo...','Incorporando atenuantes...','Finalizando el escrito de descargos...'],
  licencia: ['Revisando el motivo de rechazo...','Analizando normativa COMPIN/SUSESO...','Estructurando el recurso...','Incorporando antecedentes mÃ©dicos...','Redactando la apelaciÃ³n...'],
  fallo:    ['Analizando los hechos probados...','Estructurando los Vistos...','Redactando los Considerandos...','Aplicando sana crÃ­tica (art. 456 CT)...','Elaborando la Parte Resolutiva...'],
  cortes:   ['Consultando tendencias locales...','Analizando jurisprudencia del distrito...','Identificando criterios especÃ­ficos...','Evaluando estrategias locales...','Preparando el informe...'],
  reclamo:  ['Identificando la normativa infringida...','Estructurando el reclamo...','Incorporando fundamentos legales...','Redactando la peticiÃ³n concreta...','Finalizando el documento...'],
};
function startLoadingMsg(outId,tipo='default',icon='â³'){
  const el=document.getElementById(outId);
  const msgs=LOADING_MSGS[tipo]||LOADING_MSGS.default;
  let idx=0;
  const render=()=>{el.innerHTML=`<div class="empty-box" style="gap:12px"><span style="font-size:28px;animation:spin .7s linear infinite;display:inline-block">${icon}</span><span style="font-weight:600;color:var(--p);font-size:12px" id="_ldmsg">${msgs[idx]}</span><span style="font-size:10px;color:var(--m)">Esto puede tardar unos segundosâ€¦</span></div>`;};
  render();
  const iv=setInterval(()=>{idx=(idx+1)%msgs.length;const s=document.getElementById('_ldmsg');if(s){s.style.opacity='0';setTimeout(()=>{s.textContent=msgs[idx];s.style.opacity='1';},200);}},2500);
  return ()=>clearInterval(iv);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GUARDAR CHAT (.TXT)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveChat(){
  const bubbles=document.querySelectorAll('#msgs .msg');
  if(!bubbles.length){alert('No hay mensajes en el chat para guardar.');return;}
  const lines=['JurisBot Laboral Chile â€” Historial de ConversaciÃ³n','Exportado el: '+new Date().toLocaleString('es-CL'),'â•'.repeat(55),''];
  bubbles.forEach(msg=>{
    lines.push(msg.classList.contains('user')?'ğŸ‘¤ USUARIO':'âš–ï¸ JURISBOT');
    lines.push(msg.querySelector('.bubble')?.innerText?.trim()||'');
    lines.push('â”€'.repeat(40),'');
  });
  lines.push('','âš ï¸ AVISO LEGAL: Los resultados de JurisBot son orientativos y no constituyen asesorÃ­a legal oficial.');
  const blob=new Blob([lines.join('\n')],{type:'text/plain;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download=`JurisBot_Chat_${new Date().toISOString().slice(0,10)}.txt`;
  document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DESCARGAR WORD (.DOC)
// Genera un HTML enriquecido que Word abre
// nativamente sin librerÃ­as externas.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadWord(sourceId,filename){
  const el=document.getElementById(sourceId);
  const content=el.innerText||el.textContent||'';
  if(!content.trim()||content.includes('aparecerÃ¡ aquÃ­')||content.includes('Complete')){
    alert('No hay contenido generado para descargar.');return;
  }
  const html=`
    <html xmlns:o="urn:schemas-microsoft-com:office:office"
          xmlns:w="urn:schemas-microsoft-com:office:word"
          xmlns="http://www.w3.org/TR/REC-html40">
    <head><meta charset="utf-8">
    <style>
      body{font-family:Arial,sans-serif;font-size:12pt;line-height:1.6;margin:2cm}
      p{margin-bottom:8pt}
      strong{font-weight:bold}
      .footer{font-size:9pt;color:#888;border-top:1px solid #ccc;margin-top:24pt;padding-top:8pt}
    </style></head>
    <body>
      <p><strong>JurisBot Laboral Chile</strong></p>
      <p><em>Generado el: ${new Date().toLocaleString('es-CL')}</em></p>
      <hr>
      <div>${content.replace(/\n/g,'<br>')}</div>
      <div class="footer">âš ï¸ Documento generado por JurisBot. Los resultados son orientativos y no constituyen asesorÃ­a legal oficial. Verifique siempre en fuentes oficiales: pjud.cl Â· dt.gob.cl Â· contraloria.cl</div>
    </body></html>`;
  const blob=new Blob(['\ufeff'+html],{type:'application/msword'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download=filename+'.doc';
  document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SANITIZACIÃ“N Y PARSING SEGURO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sanitizeAndParseNumber(raw){
  try{
    if(raw===null||raw===undefined)return null;
    let s=String(raw).trim();if(s==='')return null;
    s=s.replace(/[$â‚¬Â£Â¥]/g,'').replace(/\s/g,'').replace(/,/g,'');
    const pts=(s.match(/\./g)||[]).length;
    if(pts>1){s=s.replace(/\./g,'');}
    else if(pts===1){const dec=s.split('.')[1];if(dec&&dec.length>2)s=s.replace(/\./g,'');}
    s=s.replace(/[^\d.]/g,'');
    if(s===''||s==='.')return null;
    const n=parseFloat(s);
    if(!isFinite(n)||isNaN(n)||n<0)return null;
    return n;
  }catch(e){console.warn('[JurisBot] sanitize error:',e);return null;}
}
function validateField(id,errId,min,max=Infinity,isCurrency=false){
  const el=document.getElementById(id);const errEl=document.getElementById(errId);
  el.classList.remove('input-error');errEl.classList.remove('show');
  const val=isCurrency?sanitizeAndParseNumber(el.value):parseFloat(el.value);
  if(val===null||isNaN(val)||val<min||val>max){el.classList.add('input-error');errEl.classList.add('show');return null;}
  return val;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QQ={despido:'Despido injustificado artÃ­culos 159 160 161 CT jurisprudencia',acoso:'Acoso laboral artÃ­culo 2 CT mobbing jurisprudencia',tutela:'Tutela laboral artÃ­culo 485 CT derechos fundamentales',accidente:'Accidente del trabajo Ley 16744 responsabilidad empleador jurisprudencia',huelga:'NegociaciÃ³n colectiva Ley 20940 huelga servicios mÃ­nimos',honorarios:'Honorarios sector pÃºblico Contraloria vinculo laboral encubierto'};
const WELCOME_SUGGS=[{label:'Ley 16.744',desc:'Accidentes y responsabilidad del empleador',k:'accidente'},{label:'Ley 20.940',desc:'NegociaciÃ³n colectiva y huelga',k:'huelga'},{label:'Contraloria',desc:'Honorarios y vÃ­nculo laboral pÃºblico',k:'honorarios'},{label:'Tutela art. 485',desc:'Derechos fundamentales laborales',k:'tutela'}];
const LEYES=[
  {id:'ct',label:'ğŸ“– CÃ³digo del Trabajo',sub:'DFL 1/2005',titulos:[
    {n:'Contrato de Trabajo',arts:[
      {n:'2',t:'Es contrario a la dignidad de la persona el acoso sexual y el acoso laboral. Se entiende por acoso laboral toda conducta que constituya agresiÃ³n u hostigamiento reiterados que tenga como resultado menoscabo, maltrato o humillaciÃ³n, o amenace su situaciÃ³n laboral.'},
      {n:'7',t:'Contrato de trabajo es una convenciÃ³n por la cual el empleador y el trabajador se obligan recÃ­procamente: el trabajador a prestar servicios personales bajo dependencia y subordinaciÃ³n, y el empleador a pagar una remuneraciÃ³n determinada.'},
      {n:'8',t:'Toda prestaciÃ³n de servicios hace presumir la existencia de un contrato de trabajo.'},
      {n:'10',t:'El contrato debe contener: lugar y fecha; individualizaciÃ³n de las partes; naturaleza y lugar de los servicios; monto, forma y perÃ­odo de pago; duraciÃ³n y distribuciÃ³n de la jornada; plazo del contrato.'},
    ]},
    {n:'Jornada de Trabajo',arts:[
      {n:'22',t:'La jornada ordinaria no excederÃ¡ de 40 horas semanales. Quedan excluidos los gerentes, administradores y quienes trabajen sin fiscalizaciÃ³n superior inmediata.'},
      {n:'32',t:'Las horas extraordinarias se pagarÃ¡n con recargo del 50% sobre el sueldo convenido para la jornada ordinaria.'},
    ]},
    {n:'Remuneraciones',arts:[
      {n:'41',t:'RemuneraciÃ³n son las contraprestaciones en dinero y adicionales en especie que debe percibir el trabajador por causa del contrato.'},
      {n:'44',t:'El sueldo mensual no podrÃ¡ ser inferior al ingreso mÃ­nimo mensual.'},
    ]},
    {n:'TÃ©rmino del Contrato',arts:[
      {n:'159',t:'Causales sin indemnizaciÃ³n: 1. Mutuo acuerdo; 2. Renuncia (30 dÃ­as aviso); 3. Muerte; 4. Vencimiento del plazo; 5. ConclusiÃ³n del trabajo; 6. Caso fortuito o fuerza mayor.'},
      {n:'160',t:'TÃ©rmino sin indemnizaciÃ³n por causas imputables al trabajador: falta de probidad, acoso, vÃ­as de hecho, injurias, inasistencias injustificadas, abandono, incumplimiento grave de obligaciones contractuales.'},
      {n:'161',t:'Necesidades de la empresa: racionalizaciÃ³n, modernizaciÃ³n, baja productividad. Con indemnizaciÃ³n por aÃ±os de servicio y sustitutiva de aviso previo.'},
      {n:'162',t:'El aviso de despido debe ser escrito, con 30 dÃ­as de anticipaciÃ³n o pago sustitutivo equivalente a la Ãºltima remuneraciÃ³n mensual.'},
      {n:'163',t:'La indemnizaciÃ³n por aÃ±os de servicio no podrÃ¡ exceder de 90 UF del Ãºltimo mes segÃºn el contrato, calculadas Ã©stas a la fecha del tÃ©rmino del contrato.'},
      {n:'168',t:'El trabajador puede recurrir al juzgado laboral dentro de 60 dÃ­as hÃ¡biles. Recargo del 30%, 50% u 80% segÃºn causal invocada.'},
    ]},
    {n:'Tutela Laboral',arts:[
      {n:'485',t:'El procedimiento de tutela se aplica cuando actos del empleador vulneran derechos fundamentales del trabajador reconocidos en el art. 19 de la ConstituciÃ³n.'},
    ]},
  ]},
  {id:'l16744',label:'ğŸ›¡ï¸ Ley 16.744',sub:'Accidentes del Trabajo',titulos:[
    {n:'Disposiciones Generales',arts:[
      {n:'5',t:'Accidente del trabajo: toda lesiÃ³n que una persona sufra a causa o con ocasiÃ³n del trabajo. Incluye accidentes de trayecto.'},
      {n:'69',t:'Cuando el accidente se deba a culpa o dolo del empleador, la vÃ­ctima puede reclamar indemnizaciÃ³n adicional por los daÃ±os causados.'},
    ]},
  ]},
  {id:'l20940',label:'ğŸ¤ Ley 20.940',sub:'ModernizaciÃ³n Sindical',titulos:[
    {n:'NegociaciÃ³n Colectiva',arts:[
      {n:'345',t:'La huelga se harÃ¡ efectiva al inicio de la jornada del dÃ©cimo dÃ­a siguiente a la votaciÃ³n.'},
      {n:'359',t:'Declarada la huelga, el empleador no puede contratar trabajadores que reemplacen a los huelguistas.'},
    ]},
  ]},
  {id:'estAdm',label:'ğŸ›ï¸ Estatuto Administrativo',sub:'Ley 18.834',titulos:[
    {n:'Sumarios Administrativos',arts:[
      {n:'137',t:'El fiscal formularÃ¡ cargos en resoluciÃ³n fundada. El inculpado tiene 5 dÃ­as hÃ¡biles para presentar sus descargos.'},
      {n:'147',t:'La destituciÃ³n es la medida disciplinaria de mayor gravedad.'},
    ]},
  ]},
];
const CTR=[
  {num:'2.669/2017',mat:'Honorarios â€” VÃ­nculo laboral encubierto',res:'Si concurren elementos de subordinaciÃ³n y dependencia, puede configurarse una relaciÃ³n laboral encubierta.',tags:['Honorarios','VÃ­nculo laboral']},
  {num:'68.773/2016',mat:'Funcionarios a contrata â€” RenovaciÃ³n y cese',res:'Los funcionarios a contrata cesan automÃ¡ticamente el 31 de diciembre. La no renovaciÃ³n no requiere expresiÃ³n de causa.',tags:['A contrata','RenovaciÃ³n']},
  {num:'55.030/2019',mat:'Acoso laboral en sector pÃºblico',res:'El acoso laboral en la funciÃ³n pÃºblica configura una infracciÃ³n grave que puede derivar en destituciÃ³n.',tags:['Acoso laboral','DestituciÃ³n']},
  {num:'3.210/2025',mat:'Honorarios â€” Expectativa legÃ­tima de renovaciÃ³n (+3 aÃ±os)',res:'Los contratados a honorarios por mÃ¡s de 3 aÃ±os en labores permanentes tienen expectativa legÃ­tima de renovaciÃ³n.',tags:['Honorarios','Expectativa legÃ­tima']},
];
const ALL_MATERIAS=['Despido injustificado','Acoso laboral','SubcontrataciÃ³n','Sector pÃºblico','Sindicatos y huelga','Accidentes del trabajo','Remuneraciones','Tutela laboral','Teletrabajo','Maternidad y paternidad','Contrato a honorarios'];
const SENTENCIAS=[
  {id:1,tipo:'cambio',tribunal:'Corte Suprema, Cuarta Sala',fecha:'15 enero 2025',rol:'45.678-2024',materia:'Despido injustificado',titulo:'Suprema cambia criterio sobre descuento de AFC en despidos por necesidades de la empresa',tldr:'âš–ï¸ **Cambio:** La Suprema establece que el descuento del seguro de cesantÃ­a sÃ­ procede en despidos por art. 161 CT.',cita:'ExcelentÃ­sima Corte Suprema, Cuarta Sala, 15 de enero de 2025, Rol NÂ° 45.678-2024'},
  {id:2,tipo:'nuevo',tribunal:'Corte de Apelaciones de Santiago',fecha:'8 febrero 2025',rol:'12.340-2024',materia:'Acoso laboral',titulo:'CA Santiago: El silencio del empleador ante denuncias de acoso configura vulneraciÃ³n de derechos fundamentales',tldr:'ğŸ†• **Criterio nuevo:** La omisiÃ³n de iniciar una investigaciÃ³n dentro de 30 dÃ­as constituye vulneraciÃ³n del art. 19 NÂ°1 CPR.',cita:'IlustrÃ­sima Corte de Apelaciones de Santiago, 8 de febrero de 2025, Rol NÂ° 12.340-2024'},
  {id:5,tipo:'nuevo',tribunal:'ContralorÃ­a General de la RepÃºblica',fecha:'5 febrero 2025',rol:'Dictamen 3.210/2025',materia:'Contrato a honorarios',titulo:'CGR: Honorarios +3 aÃ±os generan expectativa legÃ­tima de renovaciÃ³n',tldr:'ğŸ†• **Criterio nuevo:** Los contratados a honorarios por mÃ¡s de 3 aÃ±os tienen expectativa legÃ­tima de renovaciÃ³n.',cita:'ContralorÃ­a General de la RepÃºblica, Dictamen NÂ° 3.210/2025'},
];
const ESCRITOS=[
  {id:'demanda',icon:'âš–ï¸',name:'Demanda laboral',desc:'Despido injustificado o tutela',fields:[{id:'tribunal',label:'Tribunal',type:'text',ph:'ej: 1er Juzgado Laboral de Santiago'},{id:'demandante',label:'Nombre trabajador',type:'text',ph:'Nombre completo'},{id:'demandado',label:'Empleador/empresa',type:'text',ph:'Empresa S.A.'},{id:'causa',label:'Causal de despido',type:'text',ph:'ej: art. 161 CT'},{id:'hechos_dem',label:'Hechos',type:'textarea',ph:'Fecha inicio, cargo, remuneraciÃ³n, forma del despido...'},{id:'peticiones',label:'Peticiones',type:'text',ph:'ej: nulidad, indemnizaciones'}]},
  {id:'carta_aviso',icon:'ğŸ“©',name:'Carta aviso de tÃ©rmino',desc:'Arts. 159, 160, 161 CT',fields:[{id:'empleador',label:'RazÃ³n social empleador',type:'text',ph:'Empresa S.A.'},{id:'trabajador',label:'Nombre del trabajador',type:'text',ph:'Nombre completo'},{id:'causal_aviso',label:'Causal legal',type:'select',opts:['Art. 159 N1 â€” Mutuo acuerdo','Art. 159 N4 â€” Vencimiento del plazo','Art. 160 N7 â€” Incumplimiento grave','Art. 161 â€” Necesidades de la empresa']},{id:'hechos_aviso',label:'Hechos',type:'textarea',ph:'Describa los hechos...'},{id:'fecha_term',label:'Fecha de tÃ©rmino',type:'text',ph:'ej: 28 de febrero de 2026'}]},
  {id:'denuncia_dt',icon:'ğŸ“‹',name:'Denuncia Dir. Trabajo',desc:'InfracciÃ³n laboral',fields:[{id:'denunciante',label:'Nombre denunciante',type:'text',ph:'Nombre completo'},{id:'empresa_dt',label:'Empresa denunciada',type:'text',ph:'RazÃ³n social'},{id:'infraccion',label:'Tipo de infracciÃ³n',type:'select',opts:['Remuneraciones no pagadas','Horas extra no pagadas','Acoso laboral o sexual','Jornada excesiva','No pago de cotizaciones','Otra infracciÃ³n']},{id:'hechos_dt',label:'Hechos',type:'textarea',ph:'Fechas, montos, testigos...'}]},
];
const RECLAMOS=[
  {id:'isapre_cobertura',icon:'ğŸ¥',name:'Isapre â€” SuspensiÃ³n cobertura',dest:'Superintendencia de Salud',fields:[{id:'afiliado',label:'Nombre del afiliado',type:'text',ph:'Nombre completo'},{id:'isapre_nombre',label:'Isapre',type:'text',ph:'ej: Cruz Blanca'},{id:'prestacion',label:'PrestaciÃ³n afectada',type:'text',ph:'ej: DiÃ¡lisis, quimioterapia'},{id:'perjuicio',label:'Perjuicio causado',type:'textarea',ph:'Describa el daÃ±o concreto...'}]},
  {id:'dt_incumplimiento',icon:'ğŸ“‹',name:'Dir. Trabajo â€” Incumplimiento',dest:'DirecciÃ³n del Trabajo',fields:[{id:'dt_trabajador',label:'Nombre del trabajador',type:'text',ph:'Nombre completo'},{id:'dt_empresa',label:'Empresa denunciada',type:'text',ph:'RazÃ³n social y RUT'},{id:'dt_infraccion',label:'Tipo de infracciÃ³n',type:'select',opts:['Remuneraciones no pagadas','Horas extra no pagadas','Acoso laboral','Jornada excesiva','Despido verbal']},{id:'dt_hechos',label:'Hechos',type:'textarea',ph:'Fechas, montos, testigos...'}]},
];
const CORTES=['Santiago','San Miguel','ValparaÃ­so','ConcepciÃ³n','Temuco','La Serena','Antofagasta','Arica','Rancagua','Talca','Puerto Montt'];

// â•â• STATE â•â•
let chatMsgs=[],activeFilter='all',loading=false;
let activeNorm='ct',activeEscrito=null,activeReclamo=null;
let selectedMaterias=new Set(ALL_MATERIAS),prefsOpen=false;
let activeCorte=null,offlineMode=false,activeStab=0,activeTtab=0;
const VIEW_IDS={chat:'vChat',norm:'vNorm',ctr:'vCtr',calc:'vCalc',caso:'vCaso',escritos:'vEscritos',alertas:'vAlertas',sumarios:'vSumarios',tribunal:'vTribunal',cortes:'vCortes',reclamos:'vReclamos'};
const API_URL='https://jurisbot-back-end.onrender.com/consultar';

// â•â• GLOBAL CLICK â•â•
document.addEventListener('click',function(e){
  const v=e.target.closest('[data-view]');if(v){showView(v.dataset.view,+v.dataset.vi);return;}
  const f=e.target.closest('[data-filter]');if(f){setFilter(f.dataset.filter,+f.dataset.fi);return;}
  const q=e.target.closest('[data-qk]');if(q&&QQ[q.dataset.qk]){setQ(QQ[q.dataset.qk]);return;}
  const qk=e.target.closest('[data-qkey]');if(qk&&QQ[qk.dataset.qkey]){setQ(QQ[qk.dataset.qkey]);return;}
  const c=e.target.closest('[data-consult]');if(c){setQ(c.dataset.consult);return;}
  const cita=e.target.closest('[data-cita]');if(cita){copyCita(cita.dataset.cita,cita);return;}
  const chip=e.target.closest('[data-materia]');if(chip){const m=chip.dataset.materia;selectedMaterias.has(m)?selectedMaterias.delete(m):selectedMaterias.add(m);chip.classList.toggle('sel');return;}
  const cb=e.target.closest('[data-corte]');if(cb){document.querySelectorAll('.corte-btn').forEach(b=>b.classList.remove('active'));cb.classList.add('active');activeCorte=cb.dataset.corte;return;}
  const st=e.target.closest('[data-stab]');if(st){setStab(+st.dataset.stab);return;}
  const tt=e.target.closest('[data-ttab]');if(tt){setTtab(+tt.dataset.ttab);return;}
  const et=e.target.closest('[data-etype]');if(et){selectEscrito(et.dataset.etype);return;}
  const rt=e.target.closest('[data-rtype]');if(rt){selectReclamo(rt.dataset.rtype);return;}
  const id=e.target.id;
  if(id==='btnNewChat'){goChat();return;}
  if(id==='sndBtn'){sendMsg();return;}
  if(id==='saveChatBtn'){saveChat();return;}
  if(id==='calcBtn'){renderCalc();return;}
  if(id==='casoBtn'){analizarCaso();return;}
  if(id==='eGenBtn'){generarEscrito();return;}
  if(id==='prefsBtn'){togglePrefs();return;}
  if(id==='prefsSaveBtn'){savePrefs();return;}
  if(id==='copyEscritoBtn'){copyOutput('eOutput','copyEscritoBtn');return;}
  if(id==='wordEscritoBtn'){downloadWord('eOutput','JurisBot_Escrito');return;}
  if(id==='offlineToggle'){toggleOffline();return;}
  if(id==='sumariosBtn'){generarSumarios();return;}
  if(id==='licenciaBtn'){generarLicencia();return;}
  if(id==='copySumBtn'){copyOutput('sumOut','copySumBtn');return;}
  if(id==='wordSumBtn'){downloadWord('sumOut','JurisBot_Descargos');return;}
  if(id==='copyLicBtn'){copyOutput('licOut','copyLicBtn');return;}
  if(id==='wordLicBtn'){downloadWord('licOut','JurisBot_Apelacion_Licencia');return;}
  if(id==='tribBtn'){generarFallo();return;}
  if(id==='congrBtn'){revisarCongruencia();return;}
  if(id==='copyTribBtn'){copyOutput('tribOut','copyTribBtn');return;}
  if(id==='wordTribBtn'){downloadWord('tribOut','JurisBot_Fallo');return;}
  if(id==='copyCongrBtn'){copyOutput('congrOut','copyCongrBtn');return;}
  if(id==='cortesBtn'){verCriterioLocal();return;}
  if(id==='reclamoGenBtn'){generarReclamo();return;}
  if(id==='copyReclamoBtn'){copyOutput('reclamoOut','copyReclamoBtn');return;}
  if(id==='wordReclamoBtn'){downloadWord('reclamoOut','JurisBot_Reclamo');return;}
});

// â•â• NAVIGATION â•â•
function showView(v,i){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('show'));
  document.querySelectorAll('.ttab').forEach(el=>el.classList.remove('active'));
  for(let j=0;j<=10;j++){const el=document.getElementById('sb'+j);if(el)el.classList.remove('active');}
  document.getElementById(VIEW_IDS[v])?.classList.add('show');
  document.getElementById('tt'+i)?.classList.add('active');
  document.getElementById('sb'+i)?.classList.add('active');
  if(v==='norm'){renderNormNav();renderArts();}
  if(v==='ctr'){renderCtr();}
  if(v==='alertas'){renderAlertas();}
  if(v==='escritos'){renderETypes();}
  if(v==='reclamos'){renderReclamoNav();}
  if(v==='cortes'){renderCortes();}
  setTimeout(()=>trackFields(PERSISTENT_FIELDS),50);
}
function setFilter(f,i){activeFilter=f;for(let j=0;j<5;j++){document.getElementById('f'+j)?.classList.remove('active');}document.getElementById('f'+i)?.classList.add('active');}
function setStab(i){activeStab=i;document.querySelectorAll('[data-stab]').forEach(b=>b.classList.remove('active'));document.querySelector('[data-stab="'+i+'"]')?.classList.add('active');document.getElementById('sumView0').style.display=i===0?'flex':'none';document.getElementById('sumView1').style.display=i===1?'flex':'none';}
function setTtab(i){activeTtab=i;document.querySelectorAll('[data-ttab]').forEach(b=>b.classList.remove('active'));document.querySelector('[data-ttab="'+i+'"]')?.classList.add('active');document.getElementById('tribView0').style.display=i===0?'flex':'none';document.getElementById('tribView1').style.display=i===1?'flex':'none';}

// â•â• OFFLINE â•â•
function toggleOffline(){offlineMode=!offlineMode;document.getElementById('odot').style.background=offlineMode?'#ff9800':'#4caf50';document.getElementById('olabel').textContent=offlineMode?'Offline':'Online';appendMsg('bot',offlineMode?'ğŸ”Œ **Modo offline activado.**':'ğŸŒ **Modo online activado.**');showView('chat',0);}
function offlineAnswer(q){const terms=q.toLowerCase().split(/\s+/).filter(w=>w.length>3);let arts=[];LEYES.forEach(l=>l.titulos.forEach(t=>t.arts.forEach(a=>{const h=('art '+a.n+' '+a.t).toLowerCase();let s=terms.reduce((acc,w)=>acc+(h.includes(w)?1:0),0);if(s>0)arts.push({s,a,ll:l.label});})));arts.sort((a,b)=>b.s-a.s);if(!arts.length)return 'âš ï¸ No se encontraron resultados offline.';let r='ğŸ“– **Resultado offline:**\n\n';arts.slice(0,4).forEach(({a,ll})=>r+='â–¸ **Art. '+a.n+'** ('+ll+')\n'+a.t+'\n\n');return r;}

// â•â• CHAT â•â•
function setQ(txt){showView('chat',0);const inp=document.getElementById('inp');inp.value=txt;aResize(inp);inp.focus();}
function goChat(){chatMsgs=[];renderWelcome();showView('chat',0);}
function renderWelcome(){const m=document.getElementById('msgs');const s=WELCOME_SUGGS.map(x=>'<div class="sugg" data-qkey="'+x.k+'"><strong>'+x.label+'</strong>'+x.desc+'</div>').join('');m.innerHTML='<div class="welcome"><div style="font-size:42px">âš–ï¸</div><h2>JurisBot Laboral Chile</h2><p>Chat jurÃ­dico integral: CT, Ley 16.744, Ley 20.940, Estatuto Administrativo, CGR, SUSESO y mÃ¡s.</p><div class="suggs">'+s+'</div></div>';}
function aResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,90)+'px';}
function appendMsg(role,content){document.querySelector('#msgs .welcome')?.remove();const m=document.getElementById('msgs');const d=document.createElement('div');d.className='msg '+role;const av=document.createElement('div');av.className='av '+(role==='bot'?'ba':'ua');av.textContent=role==='bot'?'âš–ï¸':'AB';const b=document.createElement('div');b.className='bubble';b.innerHTML=role==='bot'?formatBot(content):escH(content);d.appendChild(av);d.appendChild(b);m.appendChild(d);m.scrollTop=m.scrollHeight;}
